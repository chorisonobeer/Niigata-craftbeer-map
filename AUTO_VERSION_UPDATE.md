# 自動バージョン更新システム

## 概要

スマートフォンでのキャッシュ問題を解決するため、修正が依頼されるたびに自動的にアプリのバージョンを0.0.1ずつ増加させるシステムです。

## 仕組み

1. **自動バージョン更新**: 修正依頼時に `auto-version-update.js` スクリプトが実行される
2. **パッチバージョン増加**: 現在のバージョンから0.0.1増加（例: 1.0.1 → 1.0.2）
3. **ファイル自動更新**:
   - `package.json` のバージョン
   - `public/version-check.js` のバージョン
   - `CHANGELOG.md` の更新履歴

## 使用方法

### 自動バージョン更新（推奨）

```bash
# 修正内容の説明付きで自動更新
npm run version:auto "修正内容の説明"

# 例
npm run version:auto "UIの2段構成修正"
npm run version:auto "ローディング状態の削除"
npm run version:auto "マップ表示の改善"
```

### 手動バージョン更新

```bash
# パッチバージョン更新（バグ修正）
npm run version:patch "修正内容"

# マイナーバージョン更新（新機能）
npm run version:minor "新機能の説明"

# メジャーバージョン更新（大幅変更）
npm run version:major "大幅変更の説明"
```

## バージョン更新の効果

### ユーザー側
- スマートフォンでアプリにアクセス時、自動的に新しいバージョンを検出
- キャッシュが自動クリアされ、最新版が表示される
- 「このアプリについて」ページで現在のバージョンを確認可能

### 開発者側
- バージョン履歴が `CHANGELOG.md` に自動記録
- `package.json` と `version-check.js` が自動同期
- デプロイ後、ユーザーに自動的に最新版が配信

## ファイル構成

```
scripts/
├── auto-version-update.js    # 自動バージョン更新スクリプト
├── update-version.js         # 手動バージョン更新スクリプト

public/
├── version-check.js          # ブラウザでのバージョンチェック

src/utils/
├── version.ts                # バージョン情報ユーティリティ

package.json                  # アプリのメインバージョン
CHANGELOG.md                 # バージョン履歴
```

## バージョンチェックの流れ

1. **ユーザーがアプリにアクセス**
2. **`version-check.js` が実行**
3. **ローカルストレージのバージョンと比較**
4. **バージョンが異なる場合**:
   - Service Worker キャッシュをクリア
   - ブラウザキャッシュをクリア
   - ローカルストレージの一部をクリア
   - 新しいバージョンを保存
   - ページをリロード

## 注意事項

- バージョン更新後は必ずコミット・デプロイを行う
- 自動更新は **パッチバージョンのみ** （0.0.1増加）
- 大きな変更の場合は手動でマイナー・メジャーバージョンを更新

## トラブルシューティング

### バージョンが表示されない
- `src/utils/version.ts` のインポートを確認
- ブラウザの開発者ツールでエラーをチェック

### キャッシュがクリアされない
- `public/version-check.js` のバージョンが更新されているか確認
- ローカルストレージを手動でクリア: `localStorage.clear()`

### バージョンの不整合
- `package.json` と `version-check.js` のバージョンが一致しているか確認
- 必要に応じて手動で同期

## 今後の改善予定

- [ ] 自動デプロイ時のバージョン自動更新
- [ ] ユーザー通知機能（新バージョンリリース時）
- [ ] バージョン履歴の詳細表示
- [ ] ロールバック機能